var B=Object.create;var{getPrototypeOf:q,defineProperty:o,getOwnPropertyNames:z}=Object;var F=Object.prototype.hasOwnProperty;var G=(s,m,r)=>{r=s!=null?B(q(s)):{};let c=m||!s||!s.__esModule?o(r,"default",{value:s,enumerable:!0}):r;for(let u of z(s))if(!F.call(c,u))o(c,u,{get:()=>s[u],enumerable:!0});return c};var H=(s,m)=>()=>(m||s((m={exports:{}}).exports,m),m.exports);var K=((s)=>typeof require!=="undefined"?require:typeof Proxy!=="undefined"?new Proxy(s,{get:(m,r)=>(typeof require!=="undefined"?require:m)[r]}):s)(function(s){if(typeof require!=="undefined")return require.apply(this,arguments);throw Error('Dynamic require of "'+s+'" is not supported')});var D=H((R,T)=>{var p=(()=>({})),M={asyncWrite:!1,syncOnWrite:!0,jsonSpaces:4,stringify:JSON.stringify,parse:JSON.parse},L=function(s){try{this.options.parse(s)}catch(m){throw console.error("Given filePath is not empty and its content is not valid JSON."),m}return!0};function n(s,m){if(!s||!s.length)throw new Error("Missing file path argument.");else this.filePath=s;if(m){for(let c in M)if(!m.hasOwnProperty(c))m[c]=M[c];this.options=m}else this.options=M;this.storage={};let r;try{r=p.statSync(s)}catch(c){if(c.code==="ENOENT")return;else if(c.code==="EACCES")throw new Error(`Cannot access path "${s}".`);else throw new Error(`Error while checking for existence of path "${s}": ${c}`)}try{p.accessSync(s,p.constants.R_OK|p.constants.W_OK)}catch(c){throw new Error(`Cannot read & write on path "${s}". Check permissions!`)}if(r.size>0){let c;try{c=p.readFileSync(s)}catch(u){throw u}if(L.bind(this)(c))this.storage=this.options.parse(c)}}n.prototype.set=function(s,m){if(this.storage[s]=m,this.options&&this.options.syncOnWrite)this.sync()};n.prototype.get=function(s){return this.storage.hasOwnProperty(s)?this.storage[s]:void 0};n.prototype.has=function(s){return this.storage.hasOwnProperty(s)};n.prototype.delete=function(s){let m=this.storage.hasOwnProperty(s)?delete this.storage[s]:void 0;if(this.options&&this.options.syncOnWrite)this.sync();return m};n.prototype.deleteAll=function(){for(var s in this.storage)this.delete(s);return this};n.prototype.sync=function(){if(this.options&&this.options.asyncWrite)p.writeFile(this.filePath,this.options.stringify(this.storage,null,this.options.jsonSpaces),(s)=>{if(s)throw s});else try{p.writeFileSync(this.filePath,this.options.stringify(this.storage,null,this.options.jsonSpaces))}catch(s){if(s.code==="EACCES")throw new Error(`Cannot access path "${this.filePath}".`);else throw new Error(`Error while writing to path "${this.filePath}": ${s}`)}};n.prototype.JSON=function(s){if(s)try{JSON.parse(this.options.stringify(s)),this.storage=s}catch(m){throw new Error("Given parameter is not a valid JSON object.")}return JSON.parse(this.options.stringify(this.storage))};T.exports=n});var w=G(D(),1),g=new w.default("./otp.json");var e=(s,m=4,r=10)=>{let c=Math.floor(Math.pow(10,m-1)+Math.random()*9*Math.pow(10,m-1)).toString(),u={otp:Number(c),expire:new Date(Date.now()+r*60*1000),phone:s};return g.set(s,u),console.log(u),{success:!0,message:"OTP generated successfully",data:u}};var x=(s)=>{return g.get(s)||null};var d=(s,m)=>{let r=x(s);if(!r)return{success:!1,message:"OTP code not found",arMessage:"لم يتم العثور على رمز التأكيد"};let c=new Date,u=new Date(r.expire);if(r?.otp&&u<c)return g.delete(s),{success:!1,message:"OTP code has expired",arMessage:"تم انتهاء صلاحية رمز التأكيد"};if(r?.otp&&Number(r.otp)!==Number(m))return{success:!1,message:"Incorrect OTP",arMessage:"رمز التأكيد غير صحيح"};if(r?.otp&&Number(r.otp)===Number(m))return g.delete(s),{success:!0,message:"OTP code verified successfully",arMessage:"تم التحقق من رمز التأكيد بنجاح"};return{success:!1,message:"OTP code not found",arMessage:"حدث خطأ في التحقق من رمز التأكيد"}};var b={generate:e,verify:d,get:x};export{b as otp};
